@model ShoppingCartViewModel
@{
    ViewBag.Title = "Cart";
}

<section id="twitter">
    <div id="main-content" class="shoppin-cart">
        <div id="twitter-feed">
            <div class="row">

                <div id="form-content" class="col-md-8 col-md-offset-2">
                    <h2>Shopping cart</h2>
                    <hr />
                    <table id="ticket-purchase" class="table table-striped table-hover ">
                        <thead>
                            <tr class="danger">

                                <th>Ticket</th>
                                <th>Place</th>
                                <th>Event</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.OrderedTickets)
                            {
                                <tr class="active">
                                    <td>Regular</td>
                                    <td> @item.PlaceName </td>
                                    <td>@item.EventTitle </td>
                                    <td>@item.Quantity </td>
                                    <td>@item.Price </td>
                                    <td>@(item.Price * item.Quantity)</td>
                                    <td><button data-id="@item.Id" class="btn  btn-sm"><i class="fa fa-trash-o"></i></button></td>
                                </tr>
                            }

                        </tbody>
                    </table>
                    <hr />
                    <div class="row">
                        <div class="col-md-2 pull-right">
                            <div>
                                <span>Total: </span>
                                <span data-id="total">200</span>
                            </div>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-md-2 pull-right">
                            <div>
                                @(Html.ActionLink<OrderController>("Proceed To Checkout", c => c.Cart(), null, new {@class = "btn btn-primary" }))
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section><!--/#twitter-feed-->

@section scripts{
    <script src="~/Scripts/Account/autoResizeDiv.js"></script>
    <script>
        var $ticketPurchase = $('#ticket-purchase');
        $ticketPurchase.on('click', 'button', function () {
            var $this = $(this);
            var id = $this.attr('data-id');
            $.post('/order/RemoveFromShoppingCart', { id: id }, function (data) {
                var badgeContainer = $('[data-id=\"shopping-cart\"]')
                $('span[data-id=\"shopping-cart-badge\"]').remove()

                var badge = $('<span />')
                    .attr('class', 'badge badge-red')
                    .attr('data-id', 'shopping-cart-badge')
                    .text(data.ItemsCount)

                $('span[data-id=\"total\"]').text(data.TotalPrice)
                badgeContainer.append(badge);
                $this.parent().parent().remove();
            })
        })
    </script>
}




